# test_hazards.btasm - Test RAW hazards and forwarding
# Tests back-to-back dependent instructions

# Initialize a constant for adding
LDI R1, 1          # R1 = 1 (will use this to increment)

# Test 1: RAW hazard with forwarding (EX-to-EX)
LDI R2, 1          # R2 = 1
ADD R3, R2, R1     # R3 = 1 + 1 = 2  (needs R2 from recent instruction - forwarding!)
ADD R4, R3, R1     # R4 = 2 + 1 = 3  (needs R3 from previous instruction - forwarding!)

# Test 2: Chain of dependencies
SUB R5, R4, R3     # R5 = 3 - 2 = 1  (uses R4, R3 - both may need forwarding)
NEG R6, R5         # R6 = -R5 = -1   (uses R5 - forwarding!)

# Test 3: No hazard (enough spacing)
NOP
NOP
ADD R7, R1, R0     # R7 = 1 + 0 = 1  (R1 is old enough, no forwarding needed)

# Test 4: Multiple uses of same register  
ADD R8, R7, R7     # R8 = 1 + 1 = 2  (both operands same, forwarding both)

# Verification: At this point should have:
# R1=1, R2=1, R3=2, R4=3, R5=1, R6=-1, R7=1, R8=2

HALT
